<div id="tbp-sources" refresh="tbp-sources">
  <% if sources.present? %>
    <% sources.each do |source| %>
      <div class="torrent-source">
        <table>
          <tr>
            <td>Title</td>
            <td class="italic ralign"><%= source[:title] %></td>
          </tr>
          <tr>
            <td>Ratio</td>
            <td class="italic ralign"><%= (source[:seeders].to_f / source[:leechers].to_f).round(2) %></td>
          </tr>
          <tr>
            <td>Seeds</td>
            <td class="italic ralign"><%= source[:seeders] %></td>
          </tr>
          <tr>
            <td>Peers</td>
            <td class="italic ralign"><%= source[:leechers] %></td>
          </tr>
        </table>
        <% if torrent = Torrent.find_by(source: source[:magnet_link]) %>
          <div class="torrent-progress-meter" data-torrent-progress-url="<%= status_torrent_path(torrent) %>">
            <div class="torrent-progress"></div>
            <span class="downloading">Downloading...</span>
          </div>
        <% else %>
          <%= form_tag download_path, method: "post" do %>
            <%= hidden_field_tag :download_url, source[:magnet_link] %>
            <%= button_tag "Download", type: "submit", class: 'action-button' %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>We searched the Pirate Bay, but it looks like no sources are available at this time :(</p>
  <% end %>
  <div class="clearfix"></div>
</div>
